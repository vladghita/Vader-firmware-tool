
####   VADER - a firmware rearrange/rewrite tool    

This is a tool for bytes rearrangement for linux firmware `(*.fw)` files. 
Some linux modules do not use external firmware files but instead embed the firmware raw data inside the module itself. Also, they might need a shifting or fluctuating bytes/line when downloading data to device, instead of constant 8-16 bytes/line.

Basically, what Vader tool does is transforming this:

```
0x08,0x04,0x01,0x00,0x00,0x08,0x05,0x32,
0xD6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x08,0x05,0xB6,0x4D,0xA7,0x66,0x4C,
0xA7,0xD1,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x09,0x38,0x71,0xE5,0x1C,0x34,
0x56,0x42,0x76,0x84,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x08,0x05,0x11,0x6F,0x2B,
0x83,0x21,0x31,0x16,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x03,0x42,0x01,0x77,
```
To this:
```
{
{8, {0x4, 0x1, 0x0, 0x0, 0x8, 0x5, 0x32, 0xd6}},
{8, {0x5, 0xb6, 0x4d, 0xa7, 0x66, 0x4c, 0xa7, 0xd1}},
{9, {0x38, 0x71, 0xe5, 0x1c, 0x34, 0x56, 0x42, 0x76, 0x84}},
{8, {0x5, 0x11, 0x6f, 0x2b, 0x83, 0x21, 0x31, 0x16}},
{3, {0x42, 0x1, 0x77}},
}
```

How to use it:
- Get the firmware file for the corresponding chip. For example "dvb-tuner-si2158-a20-01.fw"

- Convert the binary file to hex dump. For this, use Swiss File Knife (SFK) tool. 
Get it from here: http://stahlworks.com/dev/swiss-file-knife.html

`sfk hexdump -nofile -hexsrc -recsize 8 dvb-tuner-si2158-a20-01.fw > dvb-tuner-si2158-a20-01.h`

- Get the byte array contents from the generated header file (dvb-tuner-si2158-a20-01.h) and paste it to fill the unsigned char fw array
inside vader.h

- Compile and generate the binary for your system:
`gcc vader.c -o vader`

- A new file was generated by the vader tool, named "firmware.h". Get the structure contents and fill in your patch. 
For example, for si2158_firmware_2_0_build_x.h:

```
#ifndef _Si2158_FIRMWARE_2_0_BUILD_X_H_
#define _Si2158_FIRMWARE_2_0_BUILD_X_H_

#ifndef __FIRMWARE_STRUCT__
#define __FIRMWARE_STRUCT__
typedef struct firmware_struct {
	unsigned char firmware_len;
	unsigned char firmware_table[16];
} firmware_struct;
#endif /* __FIRMWARE_STRUCT__ */

firmware_struct Si2158_FW_2_0bx[] = {
{8, {0x4, 0x1, 0x0, 0x0, 0x8, 0x5, 0x32, 0xd6}},
{8, {0x5, 0xb6, 0x4d, 0xa7, 0x66, 0x4c, 0xa7, 0xd1}},
{9, {0x38, 0x71, 0xe5, 0x1c, 0x34, 0x56, 0x42, 0x76, 0x84}},
{8, {0x5, 0x11, 0x6f, 0x2b, 0x83, 0x21, 0x31, 0x16}},
{3, {0x42, 0x1, 0x77}},
...................
more bytes here
...................
```
